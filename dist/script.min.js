let pokemonRepository = (function () {
  let e = [];
  function t(e) {
    showModal(e.name, `Height: ${e.height}`, e.imageUrl);
  }
  function n(t) {
    "object" == typeof t && "name" in t
      ? e.push(t)
      : console.log("Pokemon data is incorrec");
  }
  function o() {
    return e;
  }
  return {
    getAll: o,
    add: n,
    addListItem: function e(n) {
      let o = document.querySelector(".list-group"),
        i = document.createElement("a");
      i.classList.add("list-group-element");
      let r = document.createElement("button");
      r.classList.add("btn", "btn-primary"),
        (r.innerText = n.name),
        i.appendChild(r),
        o.appendChild(i),
        r.addEventListener("click", function (e) {
          t(n);
        });
    },
    loadList: function e() {
      return fetch("https://pokeapi.co/api/v2/pokemon/?limit=150")
        .then(function (e) {
          return e.json();
        })
        .then(function (e) {
          e.results.forEach(function (e) {
            let t = { name: e.name, detailsUrl: e.url };
            n(t), console.log(t);
          });
        })
        .catch(function (e) {
          console.error(e);
        });
    },
    loadDetails: function e(t) {
      return fetch(t.detailsUrl)
        .then(function (e) {
          return e.json();
        })
        .then(function (e) {
          (t.imageUrl = e.sprites.front_default),
            (t.height = e.height),
            (t.types = e.types);
        })
        .catch(function (e) {
          console.error(t);
        });
    },
    showDetails: t,
    resetList: function () {
      let e = document.querySelector("#pokemon-list");
      (e.innerHTML = ""),
        this.getAll().forEach((e) => {
          this.addListItem(e);
        });
    },
  };
})();
function showModal(e, t, n) {
  let o = document.querySelector("#pokemonModal"),
    i = o.querySelector(".modal-title"),
    r = o.querySelector("#pokemonImage"),
    l = o.querySelector("#pokemonHeight");
  (i.innerText = e),
    (r.src = n),
    (r.alt = e),
    (l.innerText = t),
    $(o).modal("show");
}
function hideModal() {
  document.querySelector("#modal").classList.remove("is-visible");
}
function searchPokemon(e) {
  let t = document.querySelector("#pokemon-list");
  t.innerHTML = "";
  let n = pokemonRepository
    .getAll()
    .filter((t) => t.name.toLowerCase().includes(e.toLowerCase()));
  n.forEach((e) => {
    let n = document.createElement("a");
    n.classList.add("list-group-element");
    let o = document.createElement("button");
    o.classList.add("btn", "btn-primary"),
      (o.innerText = e.name),
      o.addEventListener("click", function (t) {
        pokemonRepository.showDetails(e);
      }),
      n.appendChild(o),
      t.appendChild(n);
  });
}
window.addEventListener("keydown", (e) => {
  "Escape" === e.key && hideModal();
}),
  pokemonRepository.loadList().then(function () {
    let e = pokemonRepository.getAll();
    Promise.all(e.map(pokemonRepository.loadDetails)).then(function () {
      e.forEach(function (e) {
        pokemonRepository.addListItem(e);
      });
    });
  });
const searchInput = document.querySelector("#search-input");
searchInput.addEventListener("input", function () {
  let e = searchInput.value.trim();
  "" === e ? pokemonRepository.resetList() : searchPokemon(e);
});
